# 工小聊 · 开发进度报告（PC 端）

> 更新时间：2025-10-16

## 当前版本概览
- 提供可切换演示 / 联机双模式的桌面端：同一 Node.js 服务既能直接读取本地演示数据，也暴露 `/api` 接口供联机模式同步使用。
- 登录页支持老板 / 工人 / 客户三类身份，内置演示数据与演示模式提示，确保无后端也能预览权限差异。
- 桌面端延续微信式三栏布局：左侧工单筛选与搜索，中间即时通讯对话，右侧洞察与导出操作。
- 侧栏可组合搜索、状态、优先级、负责人、客户、采购工厂与截止时间等条件过滤工单，并展示未读红点与编号。
- 顶栏新增“⌘K 全局搜索”，支持按钮或快捷键调出指挥面板，按编号、标题、客户或关注人快速跳转目标工单。
- 新增“全部已读”快捷操作，老板可一键清除所有工单未读提醒，保持侧栏视图整洁。
- 工单列表与聊天详情补充展示采购工厂徽标，支持按供应商快速锁定物料链路并在导出时保留采购信息。
- 工单列表新增截止进度徽标，标注“今日截止”“逾期”等提醒，方便老板快速识别风险。
- 新增工单置顶能力，可在侧栏一键星标重点工单并按分组展示，亦可快速切换“仅看置顶”视图聚焦关键产线。
- 聊天窗口支持文字、快捷回复、模拟语音、附件占位与系统消息，OCR 品质预览、自动采购提醒等演示流程均可触发。
- 聊天输入框按工单记忆草稿，切换会话或预览洞察后返回仍能保留未发送内容，降低来回核对资料时的信息丢失风险。
- 聊天页新增“复制编号”按钮，可一键复制工单编号，便于在 IM、ERP 或采购平台中粘贴引用。
- 新增关注人管理：工单设置支持逗号输入多位关注人，聊天详情与洞察面板会同步展示关注标签，并在 CSV/TXT/JSON 导出中保留关注人字段，方便老板安排提醒与交接。
- 工序上报弹窗提供指纹/双人确认分支，录入产量和不良后自动刷新时间线并触发补料通知演示。
- 闪电工单、时间线审计、导出 CSV/TXT/JSON、老板看板及订阅管理均可在离线模式完整体验，并能在联机模式下实时写入内存 API。
- 快捷回复管理支持按角色增删常用话术并立即反映至聊天输入区，便于个人配置保存。
- 进度时间线新增分类筛选，可按沟通记录 / 生产进度 / 自动提醒 / 闪电工单查看历史，并在洞察面板内以彩色标识突出事件类型。
- 进度时间线支持按确认方式筛选并以彩色徽标区分指纹与双人复核记录，同时在“生产日志 CSV”导出中同步标注确认方式，便于追溯审核。
- 时间线弹窗支持关键字检索，可在分类筛选的基础上快速定位指定工序、备注或操作人并显示匹配统计。
- 洞察面板导出入口新增预览弹窗，支持 CSV/TXT/JSON 下载前先校对字段并一键复制内容。
- 导出预览弹窗新增“一键打印”，自动拉起打印版式并填充工单关键指标，便于快速生成纸质存档或盖章报表。
- 导出中心扩充生产日报、送货单、对账单三类模板，支持在离线演示中预览、打印与下载不同业务票据，并新增“生产日志 CSV”
  以导出时间线分类、节点与操作人记录，便于审计留档。
- 顶栏新增订阅状态徽标，实时展示套餐、到期倒计时与名额占用情况，到期临近或封停时会以不同颜色提示老板关注续费。
- 订阅管理弹窗补齐续期、封停/解封、自动续订开关与名额增减操作，并提供基础/专业/旗舰三档套餐对比卡片，便于演示云端发码的全流程。

新增 Electron 主进程脚本，可一键打包为 Windows 便携版或安装版，方便在生产环境以 exe 形式交付。
后端工单模块引入 `WorkOrdersRepository` 抽象层，可在内存实现与未来 PostgreSQL/Redis 持久化之间快速切换，支撑 Electron 正式框架的复用需求。

## 已完成里程碑
1. **演示环境**：重构桌面端为零依赖 HTML/CSS/ESM 实现，配套 Node 静态服务器，规避 npm 403 限制。
2. **联机切换**：在桌面端与服务端实现演示 / 联机的互斥切换，联机模式可增删消息、进度与闪电工单并与 API 同步。
3. **打包准备**：引入 Electron 启动脚本与 `electron-builder` 配置，支持 `electron:build` / `electron:package` 打出 Windows 可执行文件。
4. **角色体验**：实现老板 / 工人 / 客户的界面差异与权限提示，并保留演示数据的全流程操作链路。
5. **生产闭环**：涵盖工单筛选、聊天沟通、语音与附件、工序上报、闪电工单、OCR 预览到导出文件的关键交互。
6. **经营视角**：提供洞察指标、时间线审计与老板看板，突出进度、缺陷与补料状态；订阅中心展示三档套餐及激活流程演示。

## 进行中的工作
- 梳理离线演示与 Electron + React 正式框架的组件复用方案，并基于仓储抽象整理迁移步骤。
- 基于新的仓储抽象梳理服务器内存 API 与未来 NestJS 实体的映射方式，保证联机模式可无缝切换至真实数据库。
- 梳理后端数据模型及接口契约，把演示数据映射到未来的 PostgreSQL / Redis / 对象存储方案。
- 规划 WebSocket / 推送方案，让工单与聊天状态在连接真实服务后保持实时更新。
- 设计授权中心与云端发码的正式流程，包括续期提醒、封停策略与审计日志。

## 下一步计划
- 结合 OCR 微服务与文件存储，替换当前演示用的静态品质数据，提供真实识别回传与编辑能力。
- 调整导出模板的品牌化样式与字段配置，预留多工厂自定义字段与盖章信息。
- 将采购、补料、返工等自动化流程与真实供应链系统对接，串联移动端闪电工单入口。
- 启动 Android 端原型设计，规划与 PC 端共享的 API 协议与缓存策略。
